generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  TEACHER
  STUDENT
}

enum InventoryStatus {
  AVAILABLE
  ASSIGNED
  MAINTENANCE
  RETIRED
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum RequestType {
  LEAVE
  RESOURCE
  MAINTENANCE
  OTHER
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  phone        String?  @unique
  passwordHash String
  role         Role
  displayName  String
  student      Student?
  teacher      Teacher?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Student {
  id         String   @id @default(cuid())
  userId     String   @unique
  grade      String?
  clazz      String?
  guardian   String?
  user       User     @relation(fields: [userId], references: [id])
  reports    Report[]
  requests   Request[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Teacher {
  id         String    @id @default(cuid())
  userId     String    @unique
  title      String?
  department String?
  user       User      @relation(fields: [userId], references: [id])
  advisees   Student[] @relation("TeacherAdvisee")
  reports    Report[]
  requests   Request[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}

model InventoryItem {
  id                   String         @id @default(cuid())
  name                 String
  category             String?
  status               InventoryStatus @default(AVAILABLE)
  serialNumber         String?         @unique
  assignedToStudentId  String?
  assignedToTeacherId  String?
  assignedToStudent    Student?        @relation(fields: [assignedToStudentId], references: [id])
  assignedToTeacher    Teacher?        @relation(fields: [assignedToTeacherId], references: [id])
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
}

model Venue {
  id        String   @id @default(cuid())
  name      String
  location  String?
  capacity  Int?
  resources String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Report {
  id          String   @id @default(cuid())
  studentId   String
  teacherId   String?
  weekOf      DateTime
  content     String
  feedback    String?
  aiSummary   String?
  student     Student  @relation(fields: [studentId], references: [id])
  teacher     Teacher? @relation(fields: [teacherId], references: [id])
  aiRecord    AiRecord?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Request {
  id         String       @id @default(cuid())
  type       RequestType
  status     RequestStatus @default(PENDING)
  reason     String
  studentId  String?
  teacherId  String?
  student    Student?      @relation(fields: [studentId], references: [id])
  teacher    Teacher?      @relation(fields: [teacherId], references: [id])
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
}

model AiRecord {
  id        String  @id @default(cuid())
  reportId  String  @unique
  prompt    String
  response  String
  model     String
  report    Report  @relation(fields: [reportId], references: [id])
  createdAt DateTime @default(now())
}
